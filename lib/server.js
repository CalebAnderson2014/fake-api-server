// Generated by CoffeeScript 1.8.0
(function() {
  var ResourceServer, Server, bodyParser, express;

  express = require('express');

  bodyParser = require('body-parser');

  ResourceServer = require('./resource-server');

  Server = function(options) {
    var fail, resources, server;
    if (options == null) {
      options = {};
    }
    resources = [];
    server = express();
    if (typeof options.config === "function") {
      options.config(server);
    }
    server.use(bodyParser());
    fail = function(message, code) {
      if (code == null) {
        code = 404;
      }
      throw {
        message: message,
        code: code
      };
    };
    server.on("error", function(err) {
      return console.error(err);
    });
    server.get("/", function(req, res) {
      return res.send(resources.map(function(resource) {
        return {
          name: resource.name,
          url: "/" + resource.pluralName
        };
      }));
    });
    server.register = function(url, resource) {
      if (resource === void 0) {
        resource = url;
      }
      resources = resources.concat([resource]);
      server.use("/" + resource.pluralName, new ResourceServer(resource));
      return this;
    };
    return server;
  };

  module.exports = Server;

}).call(this);
