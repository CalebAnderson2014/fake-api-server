// Generated by CoffeeScript 1.8.0
(function() {
  var Resource;

  Resource = function(name) {
    var funnels, idAttribute, idFactory, records, resource, validator;
    records = [];
    validator = null;
    funnels = [];
    idAttribute = "id";
    idFactory = function() {
      var d;
      return 1 + Math.max(0, Math.max.apply(Math, (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = records.length; _i < _len; _i++) {
          d = records[_i];
          _results.push(d[idAttribute]);
        }
        return _results;
      })()));
    };
    return resource = {
      _name: name,
      _pluralName: null,
      idAttribute: function() {
        if (arguments.length === 0) {
          return idAttribute;
        } else {
          idAttribute = arguments[0];
          return resource;
        }
      },
      idFactory: function() {
        if (arguments.length === 0) {
          return idFactory;
        } else {
          idFactory = arguments[0];
          return resource;
        }
      },
      name: function() {
        if (arguments.length === 0) {
          return resource._name;
        } else {
          resource._name = arguments[0];
          return resource;
        }
      },
      validateWith: function(v) {
        return validator = v;
      },
      addFunnel: function(f) {
        funnels.push(f);
        return this;
      },
      pluralName: function() {
        if (arguments.length === 0) {
          if (resource._pluralName) {
            return resource._pluralName;
          } else {
            return "" + resource._name + "s";
          }
        } else {
          resource._pluralName = arguments[0];
          return resource;
        }
      },
      all: function() {
        return records;
      },
      add: function(records) {
        var rec, _i, _len;
        if (records.constructor === Array) {
          for (_i = 0, _len = records.length; _i < _len; _i++) {
            rec = records[_i];
            resource.create(rec);
          }
        } else {
          resource.create(records);
        }
        return resource;
      },
      create: function(record) {
        var f, result, _i, _len;
        for (_i = 0, _len = funnels.length; _i < _len; _i++) {
          f = funnels[_i];
          record = f(record);
        }
        if (validator) {
          result = validator(record);
          if (result !== true) {
            return {
              _errors: result
            };
          }
        }
        record[idAttribute] = idFactory();
        records = records.concat([record]);
        return record;
      },
      find: function(id) {
        var record;
        record = records.filter(function(d) {
          return ("" + d[idAttribute]) === ("" + id);
        });
        if (record.length) {
          return record[0];
        } else {
          return false;
        }
      },
      update: function(id, updates) {
        var f, record, value, _i, _len;
        record = this.find(id);
        if (!record) {
          return false;
        }
        for (name in updates) {
          value = updates[name];
          if (name !== idAttribute) {
            record[name] = value;
          }
        }
        for (_i = 0, _len = funnels.length; _i < _len; _i++) {
          f = funnels[_i];
          record = f(record);
        }
        return record;
      },
      remove: function(id) {
        var record;
        record = this.find(id);
        if (!record) {
          return false;
        }
        records = records.filter(function(d) {
          return ("" + d[idAttribute]) !== ("" + id);
        });
        return true;
      }
    };
  };

  module.exports = Resource;

}).call(this);
